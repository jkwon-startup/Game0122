<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>üçî Î®πÎ∞© Í≤åÏûÑ - ÌîΩÏÖÄÏïÑÌä∏</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #1a1a2e;
            min-height: 100vh;
            min-height: 100dvh;
            font-family: 'Press Start 2P', monospace;
            image-rendering: pixelated;
            overflow: hidden;
            touch-action: manipulation;
        }
        h1 {
            color: #ffd700;
            text-shadow: 3px 3px 0px #ff6b6b;
            margin: 5px 0;
            font-size: clamp(0.8em, 4vw, 1.5em);
            font-family: 'Press Start 2P', monospace;
        }
        #game-container {
            border: 4px solid #4a4a4a;
            box-shadow: 0 0 0 2px #2a2a2a, 4px 4px 0 0 #000;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            max-width: 100%;
            touch-action: none;
        }
        .info {
            color: #aaa;
            margin-top: 8px;
            text-align: center;
            font-size: clamp(6px, 2vw, 10px);
            font-family: 'Press Start 2P', monospace;
        }
        .sound-controls {
            position: fixed;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
            z-index: 1000;
        }
        .sound-btn {
            background: #4a4a4a;
            border: 3px solid #2a2a2a;
            width: 36px;
            height: 36px;
            font-size: 14px;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            color: white;
            border-radius: 4px;
        }
        .sound-btn:hover, .sound-btn:active {
            background: #6a6a6a;
        }
        .sound-btn.muted {
            opacity: 0.4;
        }

        /* Î™®Î∞îÏùº Ïª®Ìä∏Î°§ */
        .mobile-controls {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            pointer-events: none;
        }
        .mobile-btn {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.3);
            border: 4px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            font-size: 32px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            pointer-events: auto;
            user-select: none;
            -webkit-user-select: none;
        }
        .mobile-btn:active {
            background: rgba(255, 255, 255, 0.6);
            transform: scale(0.95);
        }

        /* Î™®Î∞îÏùº Í∞êÏßÄ Ïãú Ïª®Ìä∏Î°§ ÌëúÏãú */
        @media (max-width: 600px), (hover: none) and (pointer: coarse) {
            .mobile-controls {
                display: flex;
            }
            .info {
                display: none;
            }
            body {
                padding: 5px;
            }
            h1 {
                margin: 2px 0;
            }
        }

        /* Í∞ÄÎ°ú Î™®Îìú */
        @media (orientation: landscape) and (max-height: 500px) {
            h1 {
                display: none;
            }
            .mobile-controls {
                bottom: 10px;
            }
            .mobile-btn {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="sound-controls">
        <button class="sound-btn" id="bgmBtn" onclick="toggleBGM()">‚ô™</button>
        <button class="sound-btn" id="sfxBtn" onclick="toggleSFX()">‚ô´</button>
    </div>
    <h1>MUKBANG GAME</h1>
    <div id="game-container"></div>
    <div class="info">
        <p>ARROW KEYS or A/D to MOVE</p>
    </div>

    <!-- Î™®Î∞îÏùº Ïª®Ìä∏Î°§ Î≤ÑÌäº -->
    <div class="mobile-controls">
        <button class="mobile-btn" id="leftBtn">‚óÄ</button>
        <button class="mobile-btn" id="rightBtn">‚ñ∂</button>
    </div>

    <script>
        // ============================================
        // üéÆ Î®πÎ∞© Í≤åÏûÑ - ÌîΩÏÖÄÏïÑÌä∏ Î≤ÑÏ†Ñ
        // ============================================

        const PIXEL_SIZE = 4; // Í∏∞Î≥∏ ÌîΩÏÖÄ ÌÅ¨Í∏∞
        const CANVAS_WIDTH = 400;
        const CANVAS_HEIGHT = 600;
        const PLAYER_SIZE = 48;
        const PLAYER_SPEED = 8;
        const ITEM_SIZE = 32;
        const GAME_TIME = 60;
        const SPAWN_INTERVAL_BASE = 800;

        // ÌîΩÏÖÄÏïÑÌä∏ ÏÉâÏÉÅ ÌåîÎ†àÌä∏
        const PALETTE = {
            black: '#1a1a2e',
            darkGray: '#2d2d44',
            gray: '#4a4a6a',
            lightGray: '#8888aa',
            white: '#ffffff',
            red: '#ff4757',
            darkRed: '#c0392b',
            orange: '#ff9f43',
            yellow: '#ffd700',
            darkYellow: '#d4a017',
            green: '#2ed573',
            darkGreen: '#17a05e',
            blue: '#3498db',
            darkBlue: '#2980b9',
            purple: '#9b59b6',
            pink: '#fd79a8',
            brown: '#8b4513',
            darkBrown: '#5d3a1a',
            skin: '#ffcc99',
            darkSkin: '#dda66b'
        };

        // Î†àÎ≤®Î≥Ñ ÌÖåÎßà Î∞è ÏùòÏÉÅ
        const LEVEL_THEMES = [
            {
                sky: '#87ceeb', grass: '#2ed573', name: 'GRASSLAND',
                costume: { hair: '#8b4513', shirt: '#3498db', shirtDark: '#2980b9', accessory: 'none' },
                reward: 'Í∏∞Î≥∏ ÏùòÏÉÅ'
            },
            {
                sky: '#ff9f43', grass: '#f4d03f', name: 'DESERT',
                costume: { hair: '#d4a017', shirt: '#27ae60', shirtDark: '#1e8449', accessory: 'hat' },
                reward: 'ÌÉêÌóòÍ∞Ä Î™®Ïûê'
            },
            {
                sky: '#9b59b6', grass: '#8e44ad', name: 'MAGIC LAND',
                costume: { hair: '#e056fd', shirt: '#9b59b6', shirtDark: '#7d3c98', accessory: 'wizard' },
                reward: 'ÎßàÎ≤ïÏÇ¨ Î°úÎ∏å'
            },
            {
                sky: '#3498db', grass: '#1abc9c', name: 'OCEAN',
                costume: { hair: '#00cec9', shirt: '#00b894', shirtDark: '#019875', accessory: 'goggles' },
                reward: 'Îã§Ïù¥Î≤Ñ Í≥†Í∏Ä'
            },
            {
                sky: '#ffd700', grass: '#ff6b6b', name: 'VOLCANO',
                costume: { hair: '#ffd700', shirt: '#e74c3c', shirtDark: '#c0392b', accessory: 'crown' },
                reward: 'Ï†ÑÏÑ§Ïùò ÏôïÍ¥Ä'
            }
        ];

        const LEVEL_SCORES = [0, 150, 350, 600, 900];

        // ÏÇ¨Ïö¥Îìú ÏãúÏä§ÌÖú
        let audioContext;
        let bgmEnabled = true;
        let sfxEnabled = true;
        let bgmPlaying = false;
        let bgmNoteIndex = 0;
        let bgmInterval = null;

        const BGM_MELODY = [
            { note: 523.25, duration: 150 },
            { note: 587.33, duration: 150 },
            { note: 659.25, duration: 150 },
            { note: 523.25, duration: 150 },
            { note: 783.99, duration: 300 },
            { note: 659.25, duration: 150 },
            { note: 523.25, duration: 300 },
        ];

        // Í≤åÏûÑ ÏÉÅÌÉú
        let gameState = 'start';
        let score = 0;
        let life = 3;
        let timeLeft = GAME_TIME;
        let playerX;
        let items = [];
        let particles = [];
        let lastSpawnTime = 0;
        let lastSecondTime = 0;
        let combo = 0;
        let lastEatTime = 0;
        let maxCombo = 0;
        let level = 1;
        let levelUpEffect = 0;
        let showLevelUp = false;
        let frameCounter = 0;

        // Î™®Î∞îÏùº/Î∞òÏùëÌòï Í¥ÄÎ†®
        let scaleFactor = 1;
        let isMobile = false;
        let touchLeft = false;
        let touchRight = false;

        // ÏïÑÏù¥ÌÖú ÌÉÄÏûÖ
        const ITEM_TYPES = {
            pizza:   { score: 10,  probability: 35, speed: 3, size: 'small' },
            fries:   { score: 15,  probability: 20, speed: 3, size: 'small' },
            burger:  { score: 25,  probability: 20, speed: 4, size: 'medium' },
            chicken: { score: 40,  probability: 12, speed: 4, size: 'medium' },
            cake:    { score: 60,  probability: 5,  speed: 5, size: 'large' },
            star:    { score: 100, probability: 3,  speed: 5, size: 'special' },
            bomb:    { score: -1,  probability: 5,  speed: 4, size: 'danger' }
        };

        const GRADES = [
            { min: 1000, title: 'LEGENDARY', color: PALETTE.yellow },
            { min: 500, title: 'MASTER', color: PALETTE.orange },
            { min: 200, title: 'PRO', color: PALETTE.green },
            { min: 0, title: 'NEWBIE', color: PALETTE.gray }
        ];

        // ============================================
        // Ïò§ÎîîÏò§ ÏãúÏä§ÌÖú
        // ============================================

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContext.state === 'suspended') audioContext.resume();
        }

        function playSound(type) {
            if (!sfxEnabled) return;
            initAudio();

            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.type = 'square'; // 8ÎπÑÌä∏ ÏÇ¨Ïö¥Îìú

            switch(type) {
                case 'eat':
                    osc.frequency.setValueAtTime(800, audioContext.currentTime);
                    osc.frequency.setValueAtTime(1200, audioContext.currentTime + 0.05);
                    gain.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gain.gain.setValueAtTime(0, audioContext.currentTime + 0.1);
                    osc.start(); osc.stop(audioContext.currentTime + 0.1);
                    break;
                case 'eatBig':
                    osc.frequency.setValueAtTime(600, audioContext.currentTime);
                    osc.frequency.setValueAtTime(900, audioContext.currentTime + 0.05);
                    osc.frequency.setValueAtTime(1200, audioContext.currentTime + 0.1);
                    gain.gain.setValueAtTime(0.25, audioContext.currentTime);
                    gain.gain.setValueAtTime(0, audioContext.currentTime + 0.15);
                    osc.start(); osc.stop(audioContext.currentTime + 0.15);
                    break;
                case 'star':
                    playArpeggio([1047, 1319, 1568, 2093], 0.06);
                    break;
                case 'bomb':
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, audioContext.currentTime);
                    osc.frequency.setValueAtTime(50, audioContext.currentTime + 0.2);
                    gain.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gain.gain.setValueAtTime(0, audioContext.currentTime + 0.25);
                    osc.start(); osc.stop(audioContext.currentTime + 0.25);
                    break;
                case 'levelUp':
                    playArpeggio([523, 659, 784, 1047], 0.1);
                    break;
                case 'gameOver':
                    osc.frequency.setValueAtTime(400, audioContext.currentTime);
                    osc.frequency.setValueAtTime(200, audioContext.currentTime + 0.2);
                    osc.frequency.setValueAtTime(100, audioContext.currentTime + 0.4);
                    gain.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gain.gain.setValueAtTime(0, audioContext.currentTime + 0.5);
                    osc.start(); osc.stop(audioContext.currentTime + 0.5);
                    break;
                case 'start':
                    playArpeggio([523, 659, 784], 0.08);
                    break;
            }
        }

        function playArpeggio(notes, interval) {
            notes.forEach((freq, i) => {
                setTimeout(() => {
                    if (!sfxEnabled) return;
                    const o = audioContext.createOscillator();
                    const g = audioContext.createGain();
                    o.connect(g); g.connect(audioContext.destination);
                    o.type = 'square';
                    o.frequency.value = freq;
                    g.gain.setValueAtTime(0.15, audioContext.currentTime);
                    g.gain.setValueAtTime(0, audioContext.currentTime + 0.1);
                    o.start(); o.stop(audioContext.currentTime + 0.1);
                }, i * interval * 1000);
            });
        }

        function startBGM() {
            if (!bgmEnabled || bgmPlaying) return;
            initAudio();
            bgmPlaying = true;

            function playNote() {
                if (!bgmPlaying || !bgmEnabled) return;
                const note = BGM_MELODY[bgmNoteIndex];
                const o = audioContext.createOscillator();
                const g = audioContext.createGain();
                o.connect(g); g.connect(audioContext.destination);
                o.type = 'square';
                o.frequency.value = note.note;
                g.gain.setValueAtTime(0.08, audioContext.currentTime);
                g.gain.setValueAtTime(0, audioContext.currentTime + note.duration / 1000 * 0.8);
                o.start(); o.stop(audioContext.currentTime + note.duration / 1000);
                bgmNoteIndex = (bgmNoteIndex + 1) % BGM_MELODY.length;
                bgmInterval = setTimeout(playNote, note.duration);
            }
            playNote();
        }

        function stopBGM() {
            bgmPlaying = false;
            if (bgmInterval) { clearTimeout(bgmInterval); bgmInterval = null; }
        }

        function toggleBGM() {
            bgmEnabled = !bgmEnabled;
            document.getElementById('bgmBtn').classList.toggle('muted', !bgmEnabled);
            if (bgmEnabled && gameState === 'playing') startBGM();
            else stopBGM();
        }

        function toggleSFX() {
            sfxEnabled = !sfxEnabled;
            document.getElementById('sfxBtn').classList.toggle('muted', !sfxEnabled);
        }

        // ============================================
        // ÌîΩÏÖÄ Í∑∏Î¶¨Í∏∞ Ìï®ÏàòÎì§
        // ============================================

        function drawPixelRect(x, y, w, h, col) {
            noStroke();
            fill(col);
            rect(x, y, w, h);
        }

        function drawPixelText(txt, x, y, size, col) {
            textFont('Press Start 2P');
            textSize(size);
            textAlign(CENTER, CENTER);
            noStroke();
            // Í∑∏Î¶ºÏûê
            fill(0, 0, 0, 150);
            text(txt, x + 2, y + 2);
            fill(col);
            text(txt, x, y);
        }

        // ÌîΩÏÖÄ ÌîåÎ†àÏù¥Ïñ¥ Í∑∏Î¶¨Í∏∞ (Î†àÎ≤®Î≥Ñ ÏùòÏÉÅ)
        function drawPixelPlayer(x, y, playerLevel) {
            const lvl = playerLevel || level;
            const theme = LEVEL_THEMES[min(lvl - 1, LEVEL_THEMES.length - 1)];
            const costume = theme.costume;

            const px = x - 24;
            const py = y - 24;

            // ÏïÖÏÑ∏ÏÑúÎ¶¨ (Îí§Ïóê Í∑∏Î¶¨Í∏∞)
            if (costume.accessory === 'wizard') {
                // ÎßàÎ≤ïÏÇ¨ ÎßùÌÜ†
                drawPixelRect(px + 4, py + 32, 8, 20, costume.shirt);
                drawPixelRect(px + 36, py + 32, 8, 20, costume.shirt);
            }

            // Î®∏Î¶¨ (ÌîºÎ∂ÄÏÉâ)
            drawPixelRect(px + 8, py + 4, 32, 28, PALETTE.skin);

            // Î®∏Î¶¨Ïπ¥ÎùΩ (Î†àÎ≤®Î≥Ñ ÏÉâÏÉÅ)
            drawPixelRect(px + 8, py, 32, 12, costume.hair);
            drawPixelRect(px + 4, py + 4, 4, 16, costume.hair);
            drawPixelRect(px + 40, py + 4, 4, 16, costume.hair);

            // ÏïÖÏÑ∏ÏÑúÎ¶¨ (ÏïûÏóê Í∑∏Î¶¨Í∏∞)
            if (costume.accessory === 'hat') {
                // ÌÉêÌóòÍ∞Ä Î™®Ïûê
                drawPixelRect(px + 4, py - 8, 40, 8, '#8b4513');
                drawPixelRect(px + 12, py - 16, 24, 12, '#a0522d');
            } else if (costume.accessory === 'wizard') {
                // ÎßàÎ≤ïÏÇ¨ Î™®Ïûê
                drawPixelRect(px + 8, py - 8, 32, 8, costume.shirt);
                drawPixelRect(px + 14, py - 20, 20, 16, costume.shirt);
                drawPixelRect(px + 20, py - 28, 8, 12, costume.shirt);
                // Î≥Ñ Ïû•Ïãù
                drawPixelRect(px + 22, py - 8, 4, 4, PALETTE.yellow);
            } else if (costume.accessory === 'goggles') {
                // Îã§Ïù¥Î≤Ñ Í≥†Í∏Ä
                drawPixelRect(px + 8, py + 8, 12, 8, '#2d3436');
                drawPixelRect(px + 28, py + 8, 12, 8, '#2d3436');
                drawPixelRect(px + 20, py + 10, 8, 4, '#2d3436');
                drawPixelRect(px + 10, py + 10, 8, 4, '#74b9ff');
                drawPixelRect(px + 30, py + 10, 8, 4, '#74b9ff');
            } else if (costume.accessory === 'crown') {
                // ÏôïÍ¥Ä
                drawPixelRect(px + 8, py - 12, 32, 12, PALETTE.yellow);
                drawPixelRect(px + 8, py - 20, 8, 12, PALETTE.yellow);
                drawPixelRect(px + 20, py - 24, 8, 16, PALETTE.yellow);
                drawPixelRect(px + 32, py - 20, 8, 12, PALETTE.yellow);
                // Î≥¥ÏÑù
                drawPixelRect(px + 10, py - 16, 4, 4, PALETTE.red);
                drawPixelRect(px + 22, py - 20, 4, 4, PALETTE.red);
                drawPixelRect(px + 34, py - 16, 4, 4, PALETTE.red);
            }

            // Îàà
            drawPixelRect(px + 12, py + 14, 8, 8, PALETTE.white);
            drawPixelRect(px + 28, py + 14, 8, 8, PALETTE.white);
            drawPixelRect(px + 14, py + 16, 4, 4, PALETTE.black);
            drawPixelRect(px + 30, py + 16, 4, 4, PALETTE.black);

            // Î≥ºÌÑ∞Ïπò (Î†àÎ≤® 3 Ïù¥ÏÉÅ)
            if (lvl >= 3) {
                drawPixelRect(px + 8, py + 20, 4, 4, PALETTE.pink);
                drawPixelRect(px + 36, py + 20, 4, 4, PALETTE.pink);
            }

            // ÏûÖ (ÌÅ¨Í≤å Î≤åÎ¶∞)
            drawPixelRect(px + 16, py + 24, 16, 8, PALETTE.darkRed);
            drawPixelRect(px + 18, py + 26, 12, 4, PALETTE.red);

            // Î™∏ÌÜµ (Î†àÎ≤®Î≥Ñ ÏÉâÏÉÅ)
            drawPixelRect(px + 12, py + 32, 24, 16, costume.shirt);
            drawPixelRect(px + 16, py + 34, 16, 4, costume.shirtDark);

            // Î†àÎ≤® 5 ÌäπÏàò Ìö®Í≥º (Î∞òÏßùÏûÑ)
            if (lvl >= 5 && frameCounter % 20 < 10) {
                drawPixelRect(px + 4, py - 4, 4, 4, PALETTE.yellow);
                drawPixelRect(px + 40, py + 8, 4, 4, PALETTE.yellow);
                drawPixelRect(px + 0, py + 24, 4, 4, PALETTE.yellow);
            }
        }

        // ÌîΩÏÖÄ ÌîºÏûê
        function drawPixelPizza(x, y) {
            const px = x - 16, py = y - 16;
            // Î≤†Ïù¥Ïä§
            drawPixelRect(px + 8, py + 4, 16, 4, PALETTE.yellow);
            drawPixelRect(px + 4, py + 8, 24, 4, PALETTE.yellow);
            drawPixelRect(px, py + 12, 32, 16, PALETTE.yellow);
            // ÌÜ†Ìïë
            drawPixelRect(px + 8, py + 14, 6, 6, PALETTE.red);
            drawPixelRect(px + 18, py + 16, 6, 6, PALETTE.red);
            drawPixelRect(px + 12, py + 22, 6, 6, PALETTE.red);
            // ÌÅ¨Îü¨Ïä§Ìä∏
            drawPixelRect(px, py + 28, 32, 4, PALETTE.darkYellow);
        }

        // ÌîΩÏÖÄ ÌñÑÎ≤ÑÍ±∞
        function drawPixelBurger(x, y) {
            const px = x - 16, py = y - 16;
            // ÏúÑ Îπµ
            drawPixelRect(px + 4, py, 24, 8, PALETTE.orange);
            drawPixelRect(px + 8, py + 8, 16, 4, PALETTE.orange);
            // ÏÉÅÏ∂î
            drawPixelRect(px + 2, py + 12, 28, 4, PALETTE.green);
            // Ìå®Ìã∞
            drawPixelRect(px + 4, py + 16, 24, 8, PALETTE.brown);
            // ÏπòÏ¶à
            drawPixelRect(px + 2, py + 24, 28, 4, PALETTE.yellow);
            // ÏïÑÎûò Îπµ
            drawPixelRect(px + 4, py + 28, 24, 4, PALETTE.darkYellow);
        }

        // ÌîΩÏÖÄ ÏπòÌÇ®
        function drawPixelChicken(x, y) {
            const px = x - 16, py = y - 16;
            // Í≥†Í∏∞
            drawPixelRect(px + 8, py, 16, 20, PALETTE.orange);
            drawPixelRect(px + 4, py + 4, 24, 12, PALETTE.orange);
            // Îºà
            drawPixelRect(px + 12, py + 20, 8, 12, PALETTE.white);
            drawPixelRect(px + 8, py + 28, 16, 4, PALETTE.lightGray);
        }

        // ÌîΩÏÖÄ Í∞êÏûêÌäÄÍπÄ
        function drawPixelFries(x, y) {
            const px = x - 12, py = y - 16;
            // Î∞ïÏä§
            drawPixelRect(px, py + 12, 24, 20, PALETTE.red);
            drawPixelRect(px + 2, py + 14, 20, 4, PALETTE.darkRed);
            // Í∞êÏûê
            drawPixelRect(px + 2, py, 4, 16, PALETTE.yellow);
            drawPixelRect(px + 8, py + 2, 4, 14, PALETTE.yellow);
            drawPixelRect(px + 14, py, 4, 16, PALETTE.yellow);
            drawPixelRect(px + 20, py + 4, 4, 12, PALETTE.yellow);
        }

        // ÌîΩÏÖÄ ÏºÄÏù¥ÌÅ¨
        function drawPixelCake(x, y) {
            const px = x - 16, py = y - 16;
            // Ï¥à
            drawPixelRect(px + 14, py, 4, 8, PALETTE.white);
            drawPixelRect(px + 12, py - 4, 8, 4, PALETTE.orange);
            // ÏúÑÏ∏µ
            drawPixelRect(px + 4, py + 8, 24, 8, PALETTE.pink);
            drawPixelRect(px + 4, py + 8, 24, 2, PALETTE.white);
            // ÏïÑÎûòÏ∏µ
            drawPixelRect(px, py + 16, 32, 12, PALETTE.pink);
            drawPixelRect(px, py + 16, 32, 2, PALETTE.white);
            // Ïû•Ïãù
            drawPixelRect(px + 6, py + 20, 4, 4, PALETTE.red);
            drawPixelRect(px + 22, py + 20, 4, 4, PALETTE.red);
        }

        // ÌîΩÏÖÄ Î≥Ñ
        function drawPixelStar(x, y) {
            const px = x - 16, py = y - 16;
            fill(PALETTE.yellow);
            noStroke();
            // Î≥Ñ Î™®Ïñë
            drawPixelRect(px + 12, py, 8, 8, PALETTE.yellow);
            drawPixelRect(px + 8, py + 8, 16, 8, PALETTE.yellow);
            drawPixelRect(px, py + 12, 32, 8, PALETTE.yellow);
            drawPixelRect(px + 4, py + 20, 24, 4, PALETTE.yellow);
            drawPixelRect(px + 4, py + 24, 8, 8, PALETTE.yellow);
            drawPixelRect(px + 20, py + 24, 8, 8, PALETTE.yellow);
        }

        // ÌîΩÏÖÄ Ìè≠ÌÉÑ
        function drawPixelBomb(x, y) {
            const px = x - 14, py = y - 16;
            // Î™∏Ï≤¥
            drawPixelRect(px + 4, py + 8, 20, 20, PALETTE.darkGray);
            drawPixelRect(px + 8, py + 4, 12, 4, PALETTE.darkGray);
            // ÌïòÏù¥ÎùºÏù¥Ìä∏
            drawPixelRect(px + 8, py + 12, 4, 4, PALETTE.gray);
            // Ïã¨ÏßÄ
            drawPixelRect(px + 12, py, 4, 8, PALETTE.brown);
            // Î∂àÍΩÉ (ÍπúÎπ°ÏûÑ)
            if (frameCounter % 10 < 5) {
                drawPixelRect(px + 10, py - 6, 8, 6, PALETTE.orange);
                drawPixelRect(px + 12, py - 8, 4, 4, PALETTE.yellow);
            }
        }

        // ÏïÑÏù¥ÌÖú Í∑∏Î¶¨Í∏∞
        function drawItem(item) {
            const x = item.displayX;
            const y = item.y;

            switch(item.type) {
                case 'pizza': drawPixelPizza(x, y); break;
                case 'burger': drawPixelBurger(x, y); break;
                case 'chicken': drawPixelChicken(x, y); break;
                case 'fries': drawPixelFries(x, y); break;
                case 'cake': drawPixelCake(x, y); break;
                case 'star': drawPixelStar(x, y); break;
                case 'bomb': drawPixelBomb(x, y); break;
            }
        }

        // ÌïòÌä∏ Í∑∏Î¶¨Í∏∞
        function drawPixelHeart(x, y, filled) {
            const col = filled ? PALETTE.red : PALETTE.darkGray;
            drawPixelRect(x, y + 4, 4, 8, col);
            drawPixelRect(x + 12, y + 4, 4, 8, col);
            drawPixelRect(x + 4, y, 4, 12, col);
            drawPixelRect(x + 8, y, 4, 12, col);
            drawPixelRect(x + 4, y + 12, 8, 4, col);
        }

        // ============================================
        // p5.js Î©îÏù∏
        // ============================================

        function setup() {
            // Î∞òÏùëÌòï Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞ Í≥ÑÏÇ∞
            calculateCanvasSize();
            let canvas = createCanvas(CANVAS_WIDTH * scaleFactor, CANVAS_HEIGHT * scaleFactor);
            canvas.parent('game-container');
            noSmooth(); // ÌîΩÏÖÄ ÏÑ†Î™ÖÌïòÍ≤å
            playerX = CANVAS_WIDTH / 2;

            // Î™®Î∞îÏùº Ïª®Ìä∏Î°§ ÏÑ§Ï†ï
            setupMobileControls();

            // ÏúàÎèÑÏö∞ Î¶¨ÏÇ¨Ïù¥Ï¶à Ïù¥Î≤§Ìä∏
            window.addEventListener('resize', handleResize);
        }

        function calculateCanvasSize() {
            isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
                       || window.innerWidth <= 600
                       || ('ontouchstart' in window);

            let maxWidth = window.innerWidth - 20;
            let maxHeight = window.innerHeight - 100;

            if (isMobile) {
                maxHeight = window.innerHeight - 180; // Î™®Î∞îÏùº Ïª®Ìä∏Î°§ Í≥µÍ∞Ñ ÌôïÎ≥¥
            }

            let scaleW = maxWidth / CANVAS_WIDTH;
            let scaleH = maxHeight / CANVAS_HEIGHT;
            scaleFactor = Math.min(scaleW, scaleH, 1.5); // ÏµúÎåÄ 1.5Î∞∞
            scaleFactor = Math.max(scaleFactor, 0.5); // ÏµúÏÜå 0.5Î∞∞
        }

        function handleResize() {
            calculateCanvasSize();
            resizeCanvas(CANVAS_WIDTH * scaleFactor, CANVAS_HEIGHT * scaleFactor);
        }

        function setupMobileControls() {
            const leftBtn = document.getElementById('leftBtn');
            const rightBtn = document.getElementById('rightBtn');

            if (leftBtn && rightBtn) {
                // ÌÑ∞Ïπò ÏãúÏûë
                leftBtn.addEventListener('touchstart', (e) => { e.preventDefault(); touchLeft = true; initAudio(); });
                rightBtn.addEventListener('touchstart', (e) => { e.preventDefault(); touchRight = true; initAudio(); });

                // ÌÑ∞Ïπò Ï¢ÖÎ£å
                leftBtn.addEventListener('touchend', (e) => { e.preventDefault(); touchLeft = false; });
                rightBtn.addEventListener('touchend', (e) => { e.preventDefault(); touchRight = false; });
                leftBtn.addEventListener('touchcancel', () => touchLeft = false);
                rightBtn.addEventListener('touchcancel', () => touchRight = false);

                // ÎßàÏö∞Ïä§ Ïù¥Î≤§Ìä∏ (ÌÖåÏä§Ìä∏Ïö©)
                leftBtn.addEventListener('mousedown', () => touchLeft = true);
                rightBtn.addEventListener('mousedown', () => touchRight = true);
                leftBtn.addEventListener('mouseup', () => touchLeft = false);
                rightBtn.addEventListener('mouseup', () => touchRight = false);
                leftBtn.addEventListener('mouseleave', () => touchLeft = false);
                rightBtn.addEventListener('mouseleave', () => touchRight = false);
            }
        }

        function draw() {
            frameCounter++;

            // Ïä§ÏºÄÏùº Ï†ÅÏö©
            scale(scaleFactor);

            switch(gameState) {
                case 'start': drawStartScreen(); break;
                case 'playing': updateGame(); drawGame(); break;
                case 'gameover': drawGameOverScreen(); break;
            }

            updateParticles();
        }

        // ============================================
        // Í≤åÏûÑ Î°úÏßÅ
        // ============================================

        function startGame() {
            gameState = 'playing';
            score = 0;
            life = 3;
            timeLeft = GAME_TIME;
            playerX = width / 2;
            items = [];
            particles = [];
            combo = 0;
            maxCombo = 0;
            level = 1;
            showLevelUp = false;
            lastSpawnTime = millis();
            lastSecondTime = millis();
            playSound('start');
            startBGM();
        }

        function updateGame() {
            // Î†àÎ≤®ÏóÖ Ï≤¥ÌÅ¨
            let newLevel = 1;
            for (let i = LEVEL_SCORES.length - 1; i >= 0; i--) {
                if (score >= LEVEL_SCORES[i]) { newLevel = i + 1; break; }
            }
            if (newLevel > level) {
                level = newLevel;
                showLevelUp = true;
                levelUpEffect = 90; // Îçî Í∏¥ ÏãúÍ∞Ñ
                playSound('levelUp');
            }

            if (levelUpEffect > 0) {
                levelUpEffect--;
                if (levelUpEffect === 0) showLevelUp = false;
            }

            if (combo > 0 && millis() - lastEatTime > 1500) combo = 0;

            // ÌÉÄÏù¥Î®∏
            if (millis() - lastSecondTime >= 1000) {
                timeLeft--;
                lastSecondTime = millis();
                if (timeLeft <= 0) {
                    gameState = 'gameover';
                    stopBGM();
                    playSound('gameOver');
                    return;
                }
            }

            // ÏûÖÎ†• (ÌÇ§Î≥¥Îìú + Î™®Î∞îÏùº ÌÑ∞Ïπò)
            if (keyIsDown(LEFT_ARROW) || keyIsDown(65) || touchLeft) playerX -= PLAYER_SPEED;
            if (keyIsDown(RIGHT_ARROW) || keyIsDown(68) || touchRight) playerX += PLAYER_SPEED;
            playerX = constrain(playerX, 30, CANVAS_WIDTH - 30);

            // ÏïÑÏù¥ÌÖú ÏÉùÏÑ±
            let spawnInterval = SPAWN_INTERVAL_BASE - (level - 1) * 80;
            if (millis() - lastSpawnTime >= max(spawnInterval, 400)) {
                spawnItem();
                lastSpawnTime = millis();
            }

            // ÏïÑÏù¥ÌÖú ÏóÖÎç∞Ïù¥Ìä∏
            for (let i = items.length - 1; i >= 0; i--) {
                let item = items[i];
                item.y += item.speed * (1 + (level - 1) * 0.15);
                item.wobble += 0.08;
                item.displayX = item.x + sin(item.wobble) * 4;

                if (checkCollision(item)) {
                    if (item.type === 'bomb') {
                        life--;
                        combo = 0;
                        playSound('bomb');
                        createPixelExplosion(item.displayX, item.y, PALETTE.red);
                        if (life <= 0) {
                            gameState = 'gameover';
                            stopBGM();
                            playSound('gameOver');
                            return;
                        }
                    } else {
                        combo++;
                        lastEatTime = millis();
                        if (combo > maxCombo) maxCombo = combo;

                        let earned = floor(item.score * (1 + (combo - 1) * 0.2));
                        score += earned;

                        if (item.type === 'star') playSound('star');
                        else if (item.size === 'large') playSound('eatBig');
                        else playSound('eat');

                        createPixelExplosion(item.displayX, item.y, PALETTE.yellow);
                        createScorePopup(item.displayX, item.y - 20, earned);
                    }
                    items.splice(i, 1);
                    continue;
                }

                if (item.y > height + 40) items.splice(i, 1);
            }
        }

        function spawnItem() {
            let rand = random(100), cumulative = 0, type = 'pizza';
            for (let t in ITEM_TYPES) {
                cumulative += ITEM_TYPES[t].probability;
                if (rand < cumulative) { type = t; break; }
            }
            let data = ITEM_TYPES[type];
            items.push({
                type: type,
                score: data.score,
                speed: data.speed,
                size: data.size,
                x: random(40, width - 40),
                displayX: 0,
                y: -40,
                wobble: random(TWO_PI)
            });
        }

        function checkCollision(item) {
            return abs(playerX - item.displayX) < 36 && abs((height - 80) - item.y) < 36;
        }

        // ÌååÌã∞ÌÅ¥
        function createPixelExplosion(x, y, col) {
            for (let i = 0; i < 8; i++) {
                particles.push({
                    x: x, y: y,
                    vx: random(-4, 4),
                    vy: random(-6, -2),
                    size: random(4, 12),
                    color: col,
                    life: 1
                });
            }
        }

        function createScorePopup(x, y, points) {
            particles.push({
                x: x, y: y, vx: 0, vy: -1.5,
                text: '+' + points,
                color: PALETTE.yellow,
                life: 1,
                isText: true
            });
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx || 0;
                p.y += p.vy || 0;
                if (!p.isText) p.vy += 0.3;
                p.life -= 0.025;
                if (p.life <= 0) particles.splice(i, 1);
            }
        }

        function drawParticles() {
            for (let p of particles) {
                if (p.isText) {
                    drawPixelText(p.text, p.x, p.y, 12, p.color);
                } else {
                    let s = p.size * p.life;
                    drawPixelRect(p.x - s/2, p.y - s/2, s, s, p.color);
                }
            }
        }

        // ============================================
        // ÌôîÎ©¥ Í∑∏Î¶¨Í∏∞
        // ============================================

        function drawStartScreen() {
            let theme = LEVEL_THEMES[0];

            // Î∞∞Í≤Ω
            background(theme.sky);

            // Íµ¨Î¶Ñ
            for (let i = 0; i < 5; i++) {
                let cx = ((frameCounter * 0.3 + i * 100) % (width + 80)) - 40;
                drawPixelRect(cx, 60 + i * 30, 48, 16, PALETTE.white);
                drawPixelRect(cx + 8, 52 + i * 30, 32, 8, PALETTE.white);
            }

            // Î∞îÎã•
            for (let i = 0; i < width; i += 16) {
                drawPixelRect(i, height - 60, 16, 60, theme.grass);
                if ((i / 16) % 2 === 0) drawPixelRect(i, height - 60, 16, 8, PALETTE.darkGreen);
            }

            // ÌÉÄÏù¥ÌãÄ Î∞ïÏä§
            drawPixelRect(40, 50, 320, 70, PALETTE.darkGray);
            drawPixelRect(44, 54, 312, 62, PALETTE.blue);
            drawPixelText('MUKBANG', width/2, 72, 22, PALETTE.yellow);
            drawPixelText('GAME', width/2, 98, 22, PALETTE.white);

            // Î†àÎ≤®Î≥Ñ Ï∫êÎ¶≠ÌÑ∞ ÎØ∏Î¶¨Î≥¥Í∏∞
            drawPixelRect(20, 135, 360, 90, PALETTE.darkGray);
            drawPixelRect(24, 139, 352, 82, '#2d3436');
            drawPixelText('UNLOCK COSTUMES!', width/2, 152, 10, PALETTE.pink);

            for (let i = 0; i < 5; i++) {
                let cx = 55 + i * 72;
                // Î†àÎ≤® Î∞∞Í≤Ω
                let lvlTheme = LEVEL_THEMES[i];
                drawPixelRect(cx - 28, 168, 56, 50, lvlTheme.costume.shirtDark);
                drawPixelPlayer(cx, 195, i + 1);
                drawPixelText('LV' + (i + 1), cx, 225, 8, PALETTE.white);
            }

            // Î≤ÑÌäº
            drawPixelButton('START', width/2, 270, 160, 45, PALETTE.green, PALETTE.darkGreen);
            drawPixelButton('EXIT', width/2, 325, 140, 35, PALETTE.red, PALETTE.darkRed);

            // ÏïàÎÇ¥
            drawPixelText('ARROW KEYS TO MOVE', width/2, 370, 9, PALETTE.white);
            drawPixelText('EAT FOOD, AVOID BOMBS!', width/2, 385, 8, PALETTE.lightGray);

            // Î†àÎ≤® Ï†êÏàò ÏïàÎÇ¥
            drawPixelRect(40, 405, 320, 55, PALETTE.darkGray);
            drawPixelRect(44, 409, 312, 47, '#2d3436');
            drawPixelText('LEVEL GOALS', width/2, 420, 10, PALETTE.yellow);
            drawPixelText('LV2:150  LV3:350  LV4:600  LV5:900', width/2, 438, 8, PALETTE.lightGray);

            // Ï†êÏàòÌëú
            drawPixelText('SCORE: PIZZA:10 BURGER:25 CHICKEN:40', width/2, 475, 7, PALETTE.yellow);
            drawPixelText('FRIES:15  CAKE:60  STAR:100', width/2, 490, 7, PALETTE.orange);

            // ÌòÑÏû¨ Ï∫êÎ¶≠ÌÑ∞ (ÏõÄÏßÅÏù¥Îäî)
            let bobY = sin(frameCounter * 0.1) * 3;
            drawPixelPlayer(width/2, height - 35 + bobY, 1);
        }

        function drawPixelButton(label, x, y, w, h, col, darkCol) {
            drawPixelRect(x - w/2 + 4, y - h/2 + 4, w, h, PALETTE.black);
            drawPixelRect(x - w/2, y - h/2, w, h, darkCol);
            drawPixelRect(x - w/2 + 4, y - h/2 + 4, w - 8, h - 8, col);
            drawPixelText(label, x, y, 14, PALETTE.white);
        }

        function drawGame() {
            let theme = LEVEL_THEMES[min(level - 1, LEVEL_THEMES.length - 1)];

            // ÌïòÎäò
            background(theme.sky);

            // Íµ¨Î¶Ñ
            for (let i = 0; i < 4; i++) {
                let cx = ((frameCounter * 0.2 + i * 120) % (width + 60)) - 30;
                drawPixelRect(cx, 80 + i * 50, 40, 12, PALETTE.white);
                drawPixelRect(cx + 6, 74 + i * 50, 28, 6, PALETTE.white);
            }

            // ÎïÖ
            for (let i = 0; i < width; i += 16) {
                drawPixelRect(i, height - 60, 16, 60, theme.grass);
                if ((i / 16 + level) % 3 === 0) drawPixelRect(i, height - 60, 16, 8, PALETTE.darkGreen);
            }

            // ÏïÑÏù¥ÌÖú
            for (let item of items) drawItem(item);

            // ÌîåÎ†àÏù¥Ïñ¥ (ÌòÑÏû¨ Î†àÎ≤® ÏùòÏÉÅ)
            drawPixelPlayer(playerX, height - 80, level);

            // ÌååÌã∞ÌÅ¥
            drawParticles();

            // HUD
            drawHUD();

            // Î†àÎ≤®ÏóÖ
            if (showLevelUp) drawLevelUpPopup();
        }

        function drawHUD() {
            let theme = LEVEL_THEMES[min(level - 1, LEVEL_THEMES.length - 1)];

            // HUD Î∞∞Í≤Ω (Î†àÎ≤® ÏÉâÏÉÅ Ï†ÅÏö©)
            drawPixelRect(0, 0, width, 56, PALETTE.darkGray);
            drawPixelRect(0, 52, width, 4, theme.costume.shirtDark);

            // ÏãúÍ∞Ñ
            let timeCol = timeLeft > 10 ? PALETTE.green : PALETTE.red;
            drawPixelText('TIME:' + timeLeft, 60, 18, 12, timeCol);

            // Î†àÎ≤® (Î†àÎ≤® ÏÉâÏÉÅ)
            drawPixelText('LV' + level, 60, 38, 10, theme.costume.shirt);

            // Îã§Ïùå Î†àÎ≤®ÍπåÏßÄ Ï†êÏàò
            let nextLevelScore = level < 5 ? LEVEL_SCORES[level] : 999;
            let progress = level < 5 ? score + '/' + nextLevelScore : 'MAX';
            drawPixelText(progress, 60, 50, 7, PALETTE.lightGray);

            // Ï†êÏàò
            drawPixelText('SCORE', width/2, 14, 10, PALETTE.lightGray);
            drawPixelText('' + score, width/2, 34, 16, PALETTE.yellow);

            // ÏΩ§Î≥¥
            if (combo > 1) {
                drawPixelText(combo + 'COMBO!', width/2, 50, 8, PALETTE.pink);
            }

            // ÌïòÌä∏
            for (let i = 0; i < 3; i++) {
                drawPixelHeart(width - 80 + i * 22, 16, i < life);
            }

            // Ï¢ÖÎ£å Î≤ÑÌäº
            drawPixelRect(width - 44, 8, 36, 20, PALETTE.gray);
            drawPixelText('X', width - 26, 18, 10, PALETTE.white);
        }

        function drawLevelUpPopup() {
            let alpha = map(levelUpEffect, 0, 90, 0, 255);

            // Î∞∞Í≤Ω Î∞ïÏä§ (Îçî ÌÅ¨Í≤å)
            fill(0, 0, 0, alpha * 0.8);
            noStroke();
            rect(30, height/2 - 120, 340, 240);

            let theme = LEVEL_THEMES[min(level - 1, LEVEL_THEMES.length - 1)];

            // ÌÖåÎëêÎ¶¨
            drawPixelRect(34, height/2 - 116, 332, 232, theme.costume.shirt);
            drawPixelRect(42, height/2 - 108, 316, 216, PALETTE.darkGray);

            // Î†àÎ≤®ÏóÖ ÌÖçÏä§Ìä∏
            drawPixelText('LEVEL UP!', width/2, height/2 - 85, 22, PALETTE.yellow);

            // Î†àÎ≤® Î∞è Ïä§ÌÖåÏù¥ÏßÄ Ïù¥Î¶Ñ
            drawPixelText('LV' + level + ' ' + theme.name, width/2, height/2 - 55, 12, PALETTE.white);

            // Íµ¨Î∂ÑÏÑ†
            drawPixelRect(60, height/2 - 38, 280, 4, PALETTE.gray);

            // Î≥¥ÏÉÅ ÌÖçÏä§Ìä∏
            drawPixelText('NEW COSTUME!', width/2, height/2 - 18, 12, PALETTE.pink);
            drawPixelText(theme.reward, width/2, height/2 + 5, 14, PALETTE.yellow);

            // Ï∫êÎ¶≠ÌÑ∞ ÎØ∏Î¶¨Î≥¥Í∏∞
            drawPixelRect(width/2 - 40, height/2 + 25, 80, 80, PALETTE.darkBlue);
            drawPixelPlayer(width/2, height/2 + 65, level);

            // Î∞òÏßùÏù¥ Ìö®Í≥º
            if (frameCounter % 8 < 4) {
                drawPixelRect(60, height/2 - 100, 8, 8, PALETTE.yellow);
                drawPixelRect(332, height/2 - 80, 8, 8, PALETTE.yellow);
                drawPixelRect(80, height/2 + 80, 8, 8, PALETTE.yellow);
                drawPixelRect(312, height/2 + 60, 8, 8, PALETTE.yellow);
            }
        }

        function drawGameOverScreen() {
            let theme = LEVEL_THEMES[min(level - 1, LEVEL_THEMES.length - 1)];
            background(theme.sky);

            // Ïñ¥ÎëêÏö¥ Ïò§Î≤ÑÎ†àÏù¥
            fill(0, 0, 0, 180);
            noStroke();
            rect(0, 0, width, height);

            // Í≤∞Í≥º Î∞ïÏä§
            drawPixelRect(30, 50, 340, 440, PALETTE.darkGray);
            drawPixelRect(38, 58, 324, 424, PALETTE.darkBlue);

            drawPixelText('GAME OVER', width/2, 95, 20, PALETTE.red);

            // Îì±Í∏â
            let grade = GRADES.find(g => score >= g.min) || GRADES[GRADES.length - 1];
            drawPixelText(grade.title, width/2, 135, 18, grade.color);

            // Ï†êÏàò
            drawPixelText('SCORE', width/2, 175, 12, PALETTE.lightGray);
            drawPixelText('' + score, width/2, 205, 24, PALETTE.yellow);

            // Ïä§ÌÉØ
            drawPixelText('MAX COMBO: ' + maxCombo, width/2, 245, 10, PALETTE.pink);

            // ÎèÑÎã¨ Î†àÎ≤® Î∞è Ï∫êÎ¶≠ÌÑ∞
            drawPixelRect(120, 265, 160, 100, PALETTE.darkGray);
            drawPixelRect(124, 269, 152, 92, theme.costume.shirtDark);
            drawPixelText('LEVEL ' + level, width/2, 285, 12, PALETTE.white);
            drawPixelText(theme.name, width/2, 302, 10, theme.costume.shirt);
            drawPixelPlayer(width/2, 340, level);

            // ÌöçÎìù ÏùòÏÉÅ ÌëúÏãú
            drawPixelText('COSTUME: ' + theme.reward, width/2, 385, 9, PALETTE.yellow);

            // Î≤ÑÌäº
            drawPixelButton('RETRY', width/2, 430, 140, 40, PALETTE.green, PALETTE.darkGreen);
            drawPixelButton('EXIT', width/2, 478, 140, 35, PALETTE.red, PALETTE.darkRed);

            // ÌååÌã∞ÌÅ¥
            if (frameCounter % 15 === 0) {
                createPixelExplosion(random(width), random(height/2),
                    [PALETTE.yellow, PALETTE.pink, PALETTE.green][floor(random(3))]);
            }
            drawParticles();
        }

        // ============================================
        // ÏûÖÎ†• Ï≤òÎ¶¨
        // ============================================

        function keyPressed() {
            if (key === ' ' || keyCode === ENTER) {
                if (gameState === 'start' || gameState === 'gameover') startGame();
            }
            if (key === 'Escape' || key === 'q') {
                if (gameState === 'playing') { gameState = 'start'; stopBGM(); }
            }
            if (key === 'm') toggleBGM();
            if (key === 'n') toggleSFX();
        }

        function mousePressed() {
            initAudio();

            // Ïä§ÏºÄÏùº Î≥¥Ï†ïÎêú Ï¢åÌëú
            let mx = mouseX / scaleFactor;
            let my = mouseY / scaleFactor;

            if (gameState === 'start') {
                // START Î≤ÑÌäº (y:270, h:45)
                if (my > 247 && my < 293 && mx > 120 && mx < 280) startGame();
                // EXIT Î≤ÑÌäº (y:325, h:35)
                if (my > 307 && my < 343 && mx > 130 && mx < 270) {
                    gameState = 'start'; // Î™®Î∞îÏùºÏóêÏÑúÎäî window.close() ÎåÄÏã†
                }
            }
            else if (gameState === 'playing') {
                if (mx > CANVAS_WIDTH - 44 && my < 40) { gameState = 'start'; stopBGM(); }
            }
            else if (gameState === 'gameover') {
                // RETRY Î≤ÑÌäº (y:430, h:40)
                if (my > 410 && my < 450 && mx > 130 && mx < 270) startGame();
                // EXIT Î≤ÑÌäº (y:478, h:35)
                if (my > 460 && my < 496 && mx > 130 && mx < 270) gameState = 'start';
            }
        }

        // ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏ ÏßÄÏõê
        function touchStarted() {
            mousePressed();
            return false; // Í∏∞Î≥∏ ÌÑ∞Ïπò ÎèôÏûë Î∞©ÏßÄ
        }
    </script>
</body>
</html>
