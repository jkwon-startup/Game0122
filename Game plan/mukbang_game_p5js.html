<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçî Î®πÎ∞© Í≤åÏûÑ - ÌîΩÏÖÄÏïÑÌä∏</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        body {
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #1a1a2e;
            min-height: 100vh;
            font-family: 'Press Start 2P', monospace;
            image-rendering: pixelated;
        }
        h1 {
            color: #ffd700;
            text-shadow: 4px 4px 0px #ff6b6b;
            margin-bottom: 10px;
            font-size: 1.5em;
            font-family: 'Press Start 2P', monospace;
        }
        #game-container {
            border: 8px solid #4a4a4a;
            box-shadow: 0 0 0 4px #2a2a2a, 8px 8px 0 0 #000;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        .info {
            color: #aaa;
            margin-top: 15px;
            text-align: center;
            font-size: 10px;
            font-family: 'Press Start 2P', monospace;
        }
        .sound-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
        .sound-btn {
            background: #4a4a4a;
            border: 4px solid #2a2a2a;
            width: 40px;
            height: 40px;
            font-size: 16px;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            color: white;
        }
        .sound-btn:hover {
            background: #6a6a6a;
        }
        .sound-btn.muted {
            opacity: 0.4;
        }
    </style>
</head>
<body>
    <div class="sound-controls">
        <button class="sound-btn" id="bgmBtn" onclick="toggleBGM()">‚ô™</button>
        <button class="sound-btn" id="sfxBtn" onclick="toggleSFX()">‚ô´</button>
    </div>
    <h1>MUKBANG GAME</h1>
    <div id="game-container"></div>
    <div class="info">
        <p>ARROW KEYS or A/D to MOVE</p>
    </div>

    <script>
        // ============================================
        // üéÆ Î®πÎ∞© Í≤åÏûÑ - ÌîΩÏÖÄÏïÑÌä∏ Î≤ÑÏ†Ñ
        // ============================================

        const PIXEL_SIZE = 4; // Í∏∞Î≥∏ ÌîΩÏÖÄ ÌÅ¨Í∏∞
        const CANVAS_WIDTH = 400;
        const CANVAS_HEIGHT = 600;
        const PLAYER_SIZE = 48;
        const PLAYER_SPEED = 8;
        const ITEM_SIZE = 32;
        const GAME_TIME = 60;
        const SPAWN_INTERVAL_BASE = 800;

        // ÌîΩÏÖÄÏïÑÌä∏ ÏÉâÏÉÅ ÌåîÎ†àÌä∏
        const PALETTE = {
            black: '#1a1a2e',
            darkGray: '#2d2d44',
            gray: '#4a4a6a',
            lightGray: '#8888aa',
            white: '#ffffff',
            red: '#ff4757',
            darkRed: '#c0392b',
            orange: '#ff9f43',
            yellow: '#ffd700',
            darkYellow: '#d4a017',
            green: '#2ed573',
            darkGreen: '#17a05e',
            blue: '#3498db',
            darkBlue: '#2980b9',
            purple: '#9b59b6',
            pink: '#fd79a8',
            brown: '#8b4513',
            darkBrown: '#5d3a1a',
            skin: '#ffcc99',
            darkSkin: '#dda66b'
        };

        // Î†àÎ≤®Î≥Ñ ÌÖåÎßà
        const LEVEL_THEMES = [
            { sky: '#87ceeb', grass: '#2ed573', name: 'GRASSLAND' },
            { sky: '#ff9f43', grass: '#f4d03f', name: 'DESERT' },
            { sky: '#9b59b6', grass: '#8e44ad', name: 'MAGIC LAND' },
            { sky: '#3498db', grass: '#1abc9c', name: 'OCEAN' },
            { sky: '#ffd700', grass: '#ff6b6b', name: 'VOLCANO' }
        ];

        const LEVEL_SCORES = [0, 100, 250, 450, 700];

        // ÏÇ¨Ïö¥Îìú ÏãúÏä§ÌÖú
        let audioContext;
        let bgmEnabled = true;
        let sfxEnabled = true;
        let bgmPlaying = false;
        let bgmNoteIndex = 0;
        let bgmInterval = null;

        const BGM_MELODY = [
            { note: 523.25, duration: 150 },
            { note: 587.33, duration: 150 },
            { note: 659.25, duration: 150 },
            { note: 523.25, duration: 150 },
            { note: 783.99, duration: 300 },
            { note: 659.25, duration: 150 },
            { note: 523.25, duration: 300 },
        ];

        // Í≤åÏûÑ ÏÉÅÌÉú
        let gameState = 'start';
        let score = 0;
        let life = 3;
        let timeLeft = GAME_TIME;
        let playerX;
        let items = [];
        let particles = [];
        let lastSpawnTime = 0;
        let lastSecondTime = 0;
        let combo = 0;
        let lastEatTime = 0;
        let maxCombo = 0;
        let level = 1;
        let levelUpEffect = 0;
        let showLevelUp = false;
        let frameCounter = 0;

        // ÏïÑÏù¥ÌÖú ÌÉÄÏûÖ
        const ITEM_TYPES = {
            pizza:   { score: 10,  probability: 35, speed: 3, size: 'small' },
            fries:   { score: 15,  probability: 20, speed: 3, size: 'small' },
            burger:  { score: 25,  probability: 20, speed: 4, size: 'medium' },
            chicken: { score: 40,  probability: 12, speed: 4, size: 'medium' },
            cake:    { score: 60,  probability: 5,  speed: 5, size: 'large' },
            star:    { score: 100, probability: 3,  speed: 5, size: 'special' },
            bomb:    { score: -1,  probability: 5,  speed: 4, size: 'danger' }
        };

        const GRADES = [
            { min: 1000, title: 'LEGENDARY', color: PALETTE.yellow },
            { min: 500, title: 'MASTER', color: PALETTE.orange },
            { min: 200, title: 'PRO', color: PALETTE.green },
            { min: 0, title: 'NEWBIE', color: PALETTE.gray }
        ];

        // ============================================
        // Ïò§ÎîîÏò§ ÏãúÏä§ÌÖú
        // ============================================

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContext.state === 'suspended') audioContext.resume();
        }

        function playSound(type) {
            if (!sfxEnabled) return;
            initAudio();

            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.type = 'square'; // 8ÎπÑÌä∏ ÏÇ¨Ïö¥Îìú

            switch(type) {
                case 'eat':
                    osc.frequency.setValueAtTime(800, audioContext.currentTime);
                    osc.frequency.setValueAtTime(1200, audioContext.currentTime + 0.05);
                    gain.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gain.gain.setValueAtTime(0, audioContext.currentTime + 0.1);
                    osc.start(); osc.stop(audioContext.currentTime + 0.1);
                    break;
                case 'eatBig':
                    osc.frequency.setValueAtTime(600, audioContext.currentTime);
                    osc.frequency.setValueAtTime(900, audioContext.currentTime + 0.05);
                    osc.frequency.setValueAtTime(1200, audioContext.currentTime + 0.1);
                    gain.gain.setValueAtTime(0.25, audioContext.currentTime);
                    gain.gain.setValueAtTime(0, audioContext.currentTime + 0.15);
                    osc.start(); osc.stop(audioContext.currentTime + 0.15);
                    break;
                case 'star':
                    playArpeggio([1047, 1319, 1568, 2093], 0.06);
                    break;
                case 'bomb':
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, audioContext.currentTime);
                    osc.frequency.setValueAtTime(50, audioContext.currentTime + 0.2);
                    gain.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gain.gain.setValueAtTime(0, audioContext.currentTime + 0.25);
                    osc.start(); osc.stop(audioContext.currentTime + 0.25);
                    break;
                case 'levelUp':
                    playArpeggio([523, 659, 784, 1047], 0.1);
                    break;
                case 'gameOver':
                    osc.frequency.setValueAtTime(400, audioContext.currentTime);
                    osc.frequency.setValueAtTime(200, audioContext.currentTime + 0.2);
                    osc.frequency.setValueAtTime(100, audioContext.currentTime + 0.4);
                    gain.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gain.gain.setValueAtTime(0, audioContext.currentTime + 0.5);
                    osc.start(); osc.stop(audioContext.currentTime + 0.5);
                    break;
                case 'start':
                    playArpeggio([523, 659, 784], 0.08);
                    break;
            }
        }

        function playArpeggio(notes, interval) {
            notes.forEach((freq, i) => {
                setTimeout(() => {
                    if (!sfxEnabled) return;
                    const o = audioContext.createOscillator();
                    const g = audioContext.createGain();
                    o.connect(g); g.connect(audioContext.destination);
                    o.type = 'square';
                    o.frequency.value = freq;
                    g.gain.setValueAtTime(0.15, audioContext.currentTime);
                    g.gain.setValueAtTime(0, audioContext.currentTime + 0.1);
                    o.start(); o.stop(audioContext.currentTime + 0.1);
                }, i * interval * 1000);
            });
        }

        function startBGM() {
            if (!bgmEnabled || bgmPlaying) return;
            initAudio();
            bgmPlaying = true;

            function playNote() {
                if (!bgmPlaying || !bgmEnabled) return;
                const note = BGM_MELODY[bgmNoteIndex];
                const o = audioContext.createOscillator();
                const g = audioContext.createGain();
                o.connect(g); g.connect(audioContext.destination);
                o.type = 'square';
                o.frequency.value = note.note;
                g.gain.setValueAtTime(0.08, audioContext.currentTime);
                g.gain.setValueAtTime(0, audioContext.currentTime + note.duration / 1000 * 0.8);
                o.start(); o.stop(audioContext.currentTime + note.duration / 1000);
                bgmNoteIndex = (bgmNoteIndex + 1) % BGM_MELODY.length;
                bgmInterval = setTimeout(playNote, note.duration);
            }
            playNote();
        }

        function stopBGM() {
            bgmPlaying = false;
            if (bgmInterval) { clearTimeout(bgmInterval); bgmInterval = null; }
        }

        function toggleBGM() {
            bgmEnabled = !bgmEnabled;
            document.getElementById('bgmBtn').classList.toggle('muted', !bgmEnabled);
            if (bgmEnabled && gameState === 'playing') startBGM();
            else stopBGM();
        }

        function toggleSFX() {
            sfxEnabled = !sfxEnabled;
            document.getElementById('sfxBtn').classList.toggle('muted', !sfxEnabled);
        }

        // ============================================
        // ÌîΩÏÖÄ Í∑∏Î¶¨Í∏∞ Ìï®ÏàòÎì§
        // ============================================

        function drawPixelRect(x, y, w, h, col) {
            noStroke();
            fill(col);
            rect(x, y, w, h);
        }

        function drawPixelText(txt, x, y, size, col) {
            textFont('Press Start 2P');
            textSize(size);
            textAlign(CENTER, CENTER);
            noStroke();
            // Í∑∏Î¶ºÏûê
            fill(0, 0, 0, 150);
            text(txt, x + 2, y + 2);
            fill(col);
            text(txt, x, y);
        }

        // ÌîΩÏÖÄ ÌîåÎ†àÏù¥Ïñ¥ Í∑∏Î¶¨Í∏∞
        function drawPixelPlayer(x, y) {
            const s = 4; // ÌîΩÏÖÄ Îã®ÏúÑ
            const px = x - 24;
            const py = y - 24;

            // Î®∏Î¶¨ (ÎÖ∏ÎûÄÏÉâ/ÌîºÎ∂ÄÏÉâ)
            drawPixelRect(px + 8, py, 32, 32, PALETTE.skin);
            drawPixelRect(px + 8, py, 32, 8, PALETTE.brown); // Î®∏Î¶¨Ïπ¥ÎùΩ

            // Îàà
            drawPixelRect(px + 12, py + 12, 8, 8, PALETTE.white);
            drawPixelRect(px + 28, py + 12, 8, 8, PALETTE.white);
            drawPixelRect(px + 14, py + 14, 4, 4, PALETTE.black);
            drawPixelRect(px + 30, py + 14, 4, 4, PALETTE.black);

            // ÏûÖ (ÌÅ¨Í≤å Î≤åÎ¶∞)
            drawPixelRect(px + 16, py + 24, 16, 8, PALETTE.darkRed);
            drawPixelRect(px + 18, py + 26, 12, 4, PALETTE.red);

            // Î™∏ÌÜµ
            drawPixelRect(px + 12, py + 32, 24, 16, PALETTE.blue);
            drawPixelRect(px + 16, py + 34, 16, 4, PALETTE.darkBlue);
        }

        // ÌîΩÏÖÄ ÌîºÏûê
        function drawPixelPizza(x, y) {
            const px = x - 16, py = y - 16;
            // Î≤†Ïù¥Ïä§
            drawPixelRect(px + 8, py + 4, 16, 4, PALETTE.yellow);
            drawPixelRect(px + 4, py + 8, 24, 4, PALETTE.yellow);
            drawPixelRect(px, py + 12, 32, 16, PALETTE.yellow);
            // ÌÜ†Ìïë
            drawPixelRect(px + 8, py + 14, 6, 6, PALETTE.red);
            drawPixelRect(px + 18, py + 16, 6, 6, PALETTE.red);
            drawPixelRect(px + 12, py + 22, 6, 6, PALETTE.red);
            // ÌÅ¨Îü¨Ïä§Ìä∏
            drawPixelRect(px, py + 28, 32, 4, PALETTE.darkYellow);
        }

        // ÌîΩÏÖÄ ÌñÑÎ≤ÑÍ±∞
        function drawPixelBurger(x, y) {
            const px = x - 16, py = y - 16;
            // ÏúÑ Îπµ
            drawPixelRect(px + 4, py, 24, 8, PALETTE.orange);
            drawPixelRect(px + 8, py + 8, 16, 4, PALETTE.orange);
            // ÏÉÅÏ∂î
            drawPixelRect(px + 2, py + 12, 28, 4, PALETTE.green);
            // Ìå®Ìã∞
            drawPixelRect(px + 4, py + 16, 24, 8, PALETTE.brown);
            // ÏπòÏ¶à
            drawPixelRect(px + 2, py + 24, 28, 4, PALETTE.yellow);
            // ÏïÑÎûò Îπµ
            drawPixelRect(px + 4, py + 28, 24, 4, PALETTE.darkYellow);
        }

        // ÌîΩÏÖÄ ÏπòÌÇ®
        function drawPixelChicken(x, y) {
            const px = x - 16, py = y - 16;
            // Í≥†Í∏∞
            drawPixelRect(px + 8, py, 16, 20, PALETTE.orange);
            drawPixelRect(px + 4, py + 4, 24, 12, PALETTE.orange);
            // Îºà
            drawPixelRect(px + 12, py + 20, 8, 12, PALETTE.white);
            drawPixelRect(px + 8, py + 28, 16, 4, PALETTE.lightGray);
        }

        // ÌîΩÏÖÄ Í∞êÏûêÌäÄÍπÄ
        function drawPixelFries(x, y) {
            const px = x - 12, py = y - 16;
            // Î∞ïÏä§
            drawPixelRect(px, py + 12, 24, 20, PALETTE.red);
            drawPixelRect(px + 2, py + 14, 20, 4, PALETTE.darkRed);
            // Í∞êÏûê
            drawPixelRect(px + 2, py, 4, 16, PALETTE.yellow);
            drawPixelRect(px + 8, py + 2, 4, 14, PALETTE.yellow);
            drawPixelRect(px + 14, py, 4, 16, PALETTE.yellow);
            drawPixelRect(px + 20, py + 4, 4, 12, PALETTE.yellow);
        }

        // ÌîΩÏÖÄ ÏºÄÏù¥ÌÅ¨
        function drawPixelCake(x, y) {
            const px = x - 16, py = y - 16;
            // Ï¥à
            drawPixelRect(px + 14, py, 4, 8, PALETTE.white);
            drawPixelRect(px + 12, py - 4, 8, 4, PALETTE.orange);
            // ÏúÑÏ∏µ
            drawPixelRect(px + 4, py + 8, 24, 8, PALETTE.pink);
            drawPixelRect(px + 4, py + 8, 24, 2, PALETTE.white);
            // ÏïÑÎûòÏ∏µ
            drawPixelRect(px, py + 16, 32, 12, PALETTE.pink);
            drawPixelRect(px, py + 16, 32, 2, PALETTE.white);
            // Ïû•Ïãù
            drawPixelRect(px + 6, py + 20, 4, 4, PALETTE.red);
            drawPixelRect(px + 22, py + 20, 4, 4, PALETTE.red);
        }

        // ÌîΩÏÖÄ Î≥Ñ
        function drawPixelStar(x, y) {
            const px = x - 16, py = y - 16;
            fill(PALETTE.yellow);
            noStroke();
            // Î≥Ñ Î™®Ïñë
            drawPixelRect(px + 12, py, 8, 8, PALETTE.yellow);
            drawPixelRect(px + 8, py + 8, 16, 8, PALETTE.yellow);
            drawPixelRect(px, py + 12, 32, 8, PALETTE.yellow);
            drawPixelRect(px + 4, py + 20, 24, 4, PALETTE.yellow);
            drawPixelRect(px + 4, py + 24, 8, 8, PALETTE.yellow);
            drawPixelRect(px + 20, py + 24, 8, 8, PALETTE.yellow);
        }

        // ÌîΩÏÖÄ Ìè≠ÌÉÑ
        function drawPixelBomb(x, y) {
            const px = x - 14, py = y - 16;
            // Î™∏Ï≤¥
            drawPixelRect(px + 4, py + 8, 20, 20, PALETTE.darkGray);
            drawPixelRect(px + 8, py + 4, 12, 4, PALETTE.darkGray);
            // ÌïòÏù¥ÎùºÏù¥Ìä∏
            drawPixelRect(px + 8, py + 12, 4, 4, PALETTE.gray);
            // Ïã¨ÏßÄ
            drawPixelRect(px + 12, py, 4, 8, PALETTE.brown);
            // Î∂àÍΩÉ (ÍπúÎπ°ÏûÑ)
            if (frameCounter % 10 < 5) {
                drawPixelRect(px + 10, py - 6, 8, 6, PALETTE.orange);
                drawPixelRect(px + 12, py - 8, 4, 4, PALETTE.yellow);
            }
        }

        // ÏïÑÏù¥ÌÖú Í∑∏Î¶¨Í∏∞
        function drawItem(item) {
            const x = item.displayX;
            const y = item.y;

            switch(item.type) {
                case 'pizza': drawPixelPizza(x, y); break;
                case 'burger': drawPixelBurger(x, y); break;
                case 'chicken': drawPixelChicken(x, y); break;
                case 'fries': drawPixelFries(x, y); break;
                case 'cake': drawPixelCake(x, y); break;
                case 'star': drawPixelStar(x, y); break;
                case 'bomb': drawPixelBomb(x, y); break;
            }
        }

        // ÌïòÌä∏ Í∑∏Î¶¨Í∏∞
        function drawPixelHeart(x, y, filled) {
            const col = filled ? PALETTE.red : PALETTE.darkGray;
            drawPixelRect(x, y + 4, 4, 8, col);
            drawPixelRect(x + 12, y + 4, 4, 8, col);
            drawPixelRect(x + 4, y, 4, 12, col);
            drawPixelRect(x + 8, y, 4, 12, col);
            drawPixelRect(x + 4, y + 12, 8, 4, col);
        }

        // ============================================
        // p5.js Î©îÏù∏
        // ============================================

        function setup() {
            let canvas = createCanvas(CANVAS_WIDTH, CANVAS_HEIGHT);
            canvas.parent('game-container');
            noSmooth(); // ÌîΩÏÖÄ ÏÑ†Î™ÖÌïòÍ≤å
            playerX = width / 2;
        }

        function draw() {
            frameCounter++;

            switch(gameState) {
                case 'start': drawStartScreen(); break;
                case 'playing': updateGame(); drawGame(); break;
                case 'gameover': drawGameOverScreen(); break;
            }

            updateParticles();
        }

        // ============================================
        // Í≤åÏûÑ Î°úÏßÅ
        // ============================================

        function startGame() {
            gameState = 'playing';
            score = 0;
            life = 3;
            timeLeft = GAME_TIME;
            playerX = width / 2;
            items = [];
            particles = [];
            combo = 0;
            maxCombo = 0;
            level = 1;
            showLevelUp = false;
            lastSpawnTime = millis();
            lastSecondTime = millis();
            playSound('start');
            startBGM();
        }

        function updateGame() {
            // Î†àÎ≤®ÏóÖ Ï≤¥ÌÅ¨
            let newLevel = 1;
            for (let i = LEVEL_SCORES.length - 1; i >= 0; i--) {
                if (score >= LEVEL_SCORES[i]) { newLevel = i + 1; break; }
            }
            if (newLevel > level) {
                level = newLevel;
                showLevelUp = true;
                levelUpEffect = 60;
                playSound('levelUp');
            }

            if (levelUpEffect > 0) {
                levelUpEffect--;
                if (levelUpEffect === 0) showLevelUp = false;
            }

            if (combo > 0 && millis() - lastEatTime > 1500) combo = 0;

            // ÌÉÄÏù¥Î®∏
            if (millis() - lastSecondTime >= 1000) {
                timeLeft--;
                lastSecondTime = millis();
                if (timeLeft <= 0) {
                    gameState = 'gameover';
                    stopBGM();
                    playSound('gameOver');
                    return;
                }
            }

            // ÏûÖÎ†•
            if (keyIsDown(LEFT_ARROW) || keyIsDown(65)) playerX -= PLAYER_SPEED;
            if (keyIsDown(RIGHT_ARROW) || keyIsDown(68)) playerX += PLAYER_SPEED;
            playerX = constrain(playerX, 30, width - 30);

            // ÏïÑÏù¥ÌÖú ÏÉùÏÑ±
            let spawnInterval = SPAWN_INTERVAL_BASE - (level - 1) * 80;
            if (millis() - lastSpawnTime >= max(spawnInterval, 400)) {
                spawnItem();
                lastSpawnTime = millis();
            }

            // ÏïÑÏù¥ÌÖú ÏóÖÎç∞Ïù¥Ìä∏
            for (let i = items.length - 1; i >= 0; i--) {
                let item = items[i];
                item.y += item.speed * (1 + (level - 1) * 0.15);
                item.wobble += 0.08;
                item.displayX = item.x + sin(item.wobble) * 4;

                if (checkCollision(item)) {
                    if (item.type === 'bomb') {
                        life--;
                        combo = 0;
                        playSound('bomb');
                        createPixelExplosion(item.displayX, item.y, PALETTE.red);
                        if (life <= 0) {
                            gameState = 'gameover';
                            stopBGM();
                            playSound('gameOver');
                            return;
                        }
                    } else {
                        combo++;
                        lastEatTime = millis();
                        if (combo > maxCombo) maxCombo = combo;

                        let earned = floor(item.score * (1 + (combo - 1) * 0.2));
                        score += earned;

                        if (item.type === 'star') playSound('star');
                        else if (item.size === 'large') playSound('eatBig');
                        else playSound('eat');

                        createPixelExplosion(item.displayX, item.y, PALETTE.yellow);
                        createScorePopup(item.displayX, item.y - 20, earned);
                    }
                    items.splice(i, 1);
                    continue;
                }

                if (item.y > height + 40) items.splice(i, 1);
            }
        }

        function spawnItem() {
            let rand = random(100), cumulative = 0, type = 'pizza';
            for (let t in ITEM_TYPES) {
                cumulative += ITEM_TYPES[t].probability;
                if (rand < cumulative) { type = t; break; }
            }
            let data = ITEM_TYPES[type];
            items.push({
                type: type,
                score: data.score,
                speed: data.speed,
                size: data.size,
                x: random(40, width - 40),
                displayX: 0,
                y: -40,
                wobble: random(TWO_PI)
            });
        }

        function checkCollision(item) {
            return abs(playerX - item.displayX) < 36 && abs((height - 80) - item.y) < 36;
        }

        // ÌååÌã∞ÌÅ¥
        function createPixelExplosion(x, y, col) {
            for (let i = 0; i < 8; i++) {
                particles.push({
                    x: x, y: y,
                    vx: random(-4, 4),
                    vy: random(-6, -2),
                    size: random(4, 12),
                    color: col,
                    life: 1
                });
            }
        }

        function createScorePopup(x, y, points) {
            particles.push({
                x: x, y: y, vx: 0, vy: -1.5,
                text: '+' + points,
                color: PALETTE.yellow,
                life: 1,
                isText: true
            });
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx || 0;
                p.y += p.vy || 0;
                if (!p.isText) p.vy += 0.3;
                p.life -= 0.025;
                if (p.life <= 0) particles.splice(i, 1);
            }
        }

        function drawParticles() {
            for (let p of particles) {
                if (p.isText) {
                    drawPixelText(p.text, p.x, p.y, 12, p.color);
                } else {
                    let s = p.size * p.life;
                    drawPixelRect(p.x - s/2, p.y - s/2, s, s, p.color);
                }
            }
        }

        // ============================================
        // ÌôîÎ©¥ Í∑∏Î¶¨Í∏∞
        // ============================================

        function drawStartScreen() {
            let theme = LEVEL_THEMES[0];

            // Î∞∞Í≤Ω
            background(theme.sky);

            // Íµ¨Î¶Ñ
            for (let i = 0; i < 5; i++) {
                let cx = ((frameCounter * 0.3 + i * 100) % (width + 80)) - 40;
                drawPixelRect(cx, 60 + i * 40, 48, 16, PALETTE.white);
                drawPixelRect(cx + 8, 52 + i * 40, 32, 8, PALETTE.white);
            }

            // Î∞îÎã•
            for (let i = 0; i < width; i += 16) {
                drawPixelRect(i, height - 80, 16, 80, theme.grass);
                if ((i / 16) % 2 === 0) drawPixelRect(i, height - 80, 16, 8, PALETTE.darkGreen);
            }

            // ÌÉÄÏù¥ÌãÄ Î∞ïÏä§
            drawPixelRect(40, 120, 320, 80, PALETTE.darkGray);
            drawPixelRect(44, 124, 312, 72, PALETTE.blue);
            drawPixelText('MUKBANG', width/2, 145, 24, PALETTE.yellow);
            drawPixelText('GAME', width/2, 175, 24, PALETTE.white);

            // Î≤ÑÌäº
            drawPixelButton('START', width/2, 280, 160, 50, PALETTE.green, PALETTE.darkGreen);
            drawPixelButton('EXIT', width/2, 350, 160, 40, PALETTE.red, PALETTE.darkRed);

            // ÏïàÎÇ¥
            drawPixelText('ARROW KEYS TO MOVE', width/2, 420, 10, PALETTE.white);
            drawPixelText('EAT FOOD, AVOID BOMBS!', width/2, 440, 8, PALETTE.lightGray);

            // Ï†êÏàòÌëú
            drawPixelText('PIZZA:10 FRIES:15', width/2, 480, 8, PALETTE.yellow);
            drawPixelText('BURGER:25 CHICKEN:40', width/2, 495, 8, PALETTE.orange);
            drawPixelText('CAKE:60 STAR:100', width/2, 510, 8, PALETTE.pink);

            // ÏÉòÌîå Ï∫êÎ¶≠ÌÑ∞
            drawPixelPlayer(width/2, height - 50);
        }

        function drawPixelButton(label, x, y, w, h, col, darkCol) {
            drawPixelRect(x - w/2 + 4, y - h/2 + 4, w, h, PALETTE.black);
            drawPixelRect(x - w/2, y - h/2, w, h, darkCol);
            drawPixelRect(x - w/2 + 4, y - h/2 + 4, w - 8, h - 8, col);
            drawPixelText(label, x, y, 14, PALETTE.white);
        }

        function drawGame() {
            let theme = LEVEL_THEMES[min(level - 1, LEVEL_THEMES.length - 1)];

            // ÌïòÎäò
            background(theme.sky);

            // Íµ¨Î¶Ñ
            for (let i = 0; i < 4; i++) {
                let cx = ((frameCounter * 0.2 + i * 120) % (width + 60)) - 30;
                drawPixelRect(cx, 80 + i * 50, 40, 12, PALETTE.white);
                drawPixelRect(cx + 6, 74 + i * 50, 28, 6, PALETTE.white);
            }

            // ÎïÖ
            for (let i = 0; i < width; i += 16) {
                drawPixelRect(i, height - 60, 16, 60, theme.grass);
                if ((i / 16 + level) % 3 === 0) drawPixelRect(i, height - 60, 16, 8, PALETTE.darkGreen);
            }

            // ÏïÑÏù¥ÌÖú
            for (let item of items) drawItem(item);

            // ÌîåÎ†àÏù¥Ïñ¥
            drawPixelPlayer(playerX, height - 80);

            // ÌååÌã∞ÌÅ¥
            drawParticles();

            // HUD
            drawHUD();

            // Î†àÎ≤®ÏóÖ
            if (showLevelUp) drawLevelUpPopup();
        }

        function drawHUD() {
            // HUD Î∞∞Í≤Ω
            drawPixelRect(0, 0, width, 56, PALETTE.darkGray);
            drawPixelRect(0, 52, width, 4, PALETTE.black);

            // ÏãúÍ∞Ñ
            let timeCol = timeLeft > 10 ? PALETTE.green : PALETTE.red;
            drawPixelText('TIME:' + timeLeft, 60, 18, 12, timeCol);

            // Î†àÎ≤®
            let theme = LEVEL_THEMES[min(level - 1, LEVEL_THEMES.length - 1)];
            drawPixelText('LV' + level, 60, 38, 10, PALETTE.lightGray);

            // Ï†êÏàò
            drawPixelText('SCORE', width/2, 14, 10, PALETTE.lightGray);
            drawPixelText('' + score, width/2, 34, 16, PALETTE.yellow);

            // ÏΩ§Î≥¥
            if (combo > 1) {
                drawPixelText(combo + 'COMBO!', width/2, 50, 8, PALETTE.pink);
            }

            // ÌïòÌä∏
            for (let i = 0; i < 3; i++) {
                drawPixelHeart(width - 80 + i * 22, 16, i < life);
            }

            // Ï¢ÖÎ£å Î≤ÑÌäº
            drawPixelRect(width - 44, 8, 36, 20, PALETTE.gray);
            drawPixelText('X', width - 26, 18, 10, PALETTE.white);
        }

        function drawLevelUpPopup() {
            let alpha = map(levelUpEffect, 0, 60, 0, 255);

            // Î∞∞Í≤Ω Î∞ïÏä§
            fill(0, 0, 0, alpha * 0.7);
            noStroke();
            rect(60, height/2 - 50, 280, 100);

            drawPixelRect(64, height/2 - 46, 272, 92, PALETTE.blue);

            drawPixelText('LEVEL UP!', width/2, height/2 - 15, 20, PALETTE.yellow);

            let theme = LEVEL_THEMES[min(level - 1, LEVEL_THEMES.length - 1)];
            drawPixelText('LV' + level + ' ' + theme.name, width/2, height/2 + 20, 12, PALETTE.white);
        }

        function drawGameOverScreen() {
            let theme = LEVEL_THEMES[min(level - 1, LEVEL_THEMES.length - 1)];
            background(theme.sky);

            // Ïñ¥ÎëêÏö¥ Ïò§Î≤ÑÎ†àÏù¥
            fill(0, 0, 0, 180);
            noStroke();
            rect(0, 0, width, height);

            // Í≤∞Í≥º Î∞ïÏä§
            drawPixelRect(40, 80, 320, 360, PALETTE.darkGray);
            drawPixelRect(48, 88, 304, 344, PALETTE.darkBlue);

            drawPixelText('GAME OVER', width/2, 130, 20, PALETTE.red);

            // Îì±Í∏â
            let grade = GRADES.find(g => score >= g.min) || GRADES[GRADES.length - 1];
            drawPixelText(grade.title, width/2, 180, 18, grade.color);

            drawPixelText('SCORE', width/2, 230, 12, PALETTE.lightGray);
            drawPixelText('' + score, width/2, 260, 24, PALETTE.yellow);

            drawPixelText('MAX COMBO: ' + maxCombo, width/2, 300, 10, PALETTE.pink);
            drawPixelText('LEVEL: ' + level, width/2, 320, 10, PALETTE.green);

            // Î≤ÑÌäº
            drawPixelButton('RETRY', width/2, 380, 140, 40, PALETTE.green, PALETTE.darkGreen);
            drawPixelButton('EXIT', width/2, 430, 140, 35, PALETTE.red, PALETTE.darkRed);

            // ÌååÌã∞ÌÅ¥
            if (frameCounter % 15 === 0) {
                createPixelExplosion(random(width), random(height/2),
                    [PALETTE.yellow, PALETTE.pink, PALETTE.green][floor(random(3))]);
            }
            drawParticles();
        }

        // ============================================
        // ÏûÖÎ†• Ï≤òÎ¶¨
        // ============================================

        function keyPressed() {
            if (key === ' ' || keyCode === ENTER) {
                if (gameState === 'start' || gameState === 'gameover') startGame();
            }
            if (key === 'Escape' || key === 'q') {
                if (gameState === 'playing') { gameState = 'start'; stopBGM(); }
            }
            if (key === 'm') toggleBGM();
            if (key === 'n') toggleSFX();
        }

        function mousePressed() {
            initAudio();

            if (gameState === 'start') {
                if (mouseY > 255 && mouseY < 305 && mouseX > 120 && mouseX < 280) startGame();
            }
            else if (gameState === 'playing') {
                if (mouseX > width - 44 && mouseY < 40) { gameState = 'start'; stopBGM(); }
            }
            else if (gameState === 'gameover') {
                if (mouseY > 360 && mouseY < 400 && mouseX > 130 && mouseX < 270) startGame();
                if (mouseY > 412 && mouseY < 447 && mouseX > 130 && mouseX < 270) gameState = 'start';
            }
        }
    </script>
</body>
</html>
